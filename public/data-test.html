<!doctype html>
<html>
  <head>
    <title>Data Loading Test</title>
    <style>
      body {
        font-family: monospace;
        margin: 20px;
        background: #000;
        color: #0f0;
      }
      .log {
        margin: 5px 0;
      }
      .error {
        color: #f00;
      }
      .success {
        color: #0f0;
      }
      .info {
        color: #ff0;
      }
    </style>
  </head>
  <body>
    <h1>üîç Data Loading Diagnostic</h1>
    <div id="log"></div>

    <script>
      const logDiv = document.getElementById('log');

      function log(message, type = 'info') {
        const div = document.createElement('div');
        div.className = `log ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logDiv.appendChild(div);
      }

      async function testDataLoading() {
        log('Starting data loading tests...', 'info');

        try {
          // Test people.json
          log('Loading people.json...', 'info');
          const peopleResponse = await fetch('/data/people.json');
          const peopleData = await peopleResponse.json();
          log(`‚úì Loaded ${peopleData.length} people records`, 'success');

          // Test first few records
          if (peopleData.length > 0) {
            log(
              `First person: ${peopleData[0].fullName} (${peopleData[0].likelihoodLevel})`,
              'info',
            );
            log(
              `Last person: ${peopleData[peopleData.length - 1].fullName} (${peopleData[peopleData.length - 1].likelihoodLevel})`,
              'info',
            );
          }

          // Test evidence_database.json
          log('Loading evidence_database.json...', 'info');
          const evidenceResponse = await fetch('/data/evidence_database.json');
          const evidenceData = await evidenceResponse.json();
          log(`‚úì Evidence database loaded: ${evidenceData.metadata.total_files} files`, 'success');

          // Test searchable_files.json
          log('Loading searchable_files.json...', 'info');
          const searchableResponse = await fetch('/data/searchable_files.json');
          const searchableData = await searchableResponse.json();
          log(`‚úì Searchable files loaded: ${searchableData.files.length} files`, 'success');

          // Test if data structure matches expectations
          const samplePerson = peopleData[0];
          const requiredFields = ['fullName', 'primaryRole', 'likelihoodLevel', 'mentions'];
          const missingFields = requiredFields.filter((field) => !samplePerson[field]);

          if (missingFields.length === 0) {
            log('‚úì Data structure is correct', 'success');
          } else {
            log(`‚úó Missing fields: ${missingFields.join(', ')}`, 'error');
          }

          // Test spice rating calculation
          const highMentionPerson = peopleData.find((p) => p.mentions > 1000);
          if (highMentionPerson) {
            log(
              `High mention person: ${highMentionPerson.fullName} (${highMentionPerson.mentions} mentions)`,
              'info',
            );
          }

          log('All data loading tests completed!', 'success');
        } catch (error) {
          log(`‚úó Error: ${error.message}`, 'error');
          console.error('Full error:', error);
        }
      }

      // Run tests
      testDataLoading();

      // Auto-refresh every 30 seconds
      setInterval(testDataLoading, 30000);
    </script>
  </body>
</html>
