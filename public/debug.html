<!DOCTYPE html>
<html>
<head>
    <title>App Debug</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #000; color: #0f0; }
        .log { margin: 5px 0; padding: 5px; border-left: 3px solid #0f0; }
        .error { color: #f00; border-left-color: #f00; }
        .warn { color: #ff0; border-left-color: #ff0; }
        .info { color: #0ff; border-left-color: #0ff; }
    </style>
</head>
<body>
    <h1>üîç App Debug Console</h1>
    <div id="log"></div>

    <script>
        const logDiv = document.getElementById('log');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(div);
        }

        // Override console methods to capture logs
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };

        console.log = function(...args) {
            log(args.join(' '), 'info');
            originalConsole.log.apply(console, args);
        };

        console.error = function(...args) {
            log(args.join(' '), 'error');
            originalConsole.error.apply(console, args);
        };

        console.warn = function(...args) {
            log(args.join(' '), 'warn');
            originalConsole.warn.apply(console, args);
        };

        // Test data loading like the app does
        async function testAppDataLoading() {
            log('Testing app-style data loading...', 'info');
            
            try {
                // Test the exact same data loading as the app
                const response = await fetch('/data/people.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const rawData = await response.json();
                log(`‚úì Loaded ${rawData.length} people records`, 'info');
                
                // Test data transformation like the app does
                const firstPerson = rawData[0];
                log(`First person: ${firstPerson.fullName}`, 'info');
                log(`Likelihood: ${firstPerson.likelihoodLevel}`, 'info');
                log(`Mentions: ${firstPerson.mentions}`, 'info');
                
                // Test if the data structure matches expectations
                const requiredFields = ['fullName', 'primaryRole', 'likelihoodLevel', 'mentions'];
                const missingFields = requiredFields.filter(field => !firstPerson[field]);
                
                if (missingFields.length === 0) {
                    log('‚úì Data structure is correct', 'info');
                } else {
                    log(`‚úó Missing fields: ${missingFields.join(', ')}`, 'error');
                }
                
                // Test pagination calculation
                const PAGE_SIZE = 24;
                const totalPages = Math.ceil(rawData.length / PAGE_SIZE);
                log(`Pagination: ${rawData.length} total, ${PAGE_SIZE} per page = ${totalPages} pages`, 'info');
                
                // Test sorting by spice level (mentions)
                const sortedByMentions = [...rawData].sort((a, b) => b.mentions - a.mentions);
                log(`Top person by mentions: ${sortedByMentions[0].fullName} (${sortedByMentions[0].mentions})`, 'info');
                
                // Test evidence database
                try {
                    const evidenceResponse = await fetch('/data/evidence_database.json');
                    const evidenceData = await evidenceResponse.json();
                    log(`‚úì Evidence database: ${evidenceData.metadata.total_files} files`, 'info');
                } catch (error) {
                    log(`‚úó Evidence database error: ${error.message}`, 'error');
                }
                
                log('All tests completed successfully!', 'info');
                
            } catch (error) {
                log(`‚úó Data loading error: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        // Run tests
        testAppDataLoading();
        
        // Also test by loading the main app in an iframe to catch any errors
        const iframe = document.createElement('iframe');
        iframe.style.width = '1px';
        iframe.style.height = '1px';
        iframe.style.position = 'absolute';
        iframe.style.left = '-9999px';
        iframe.src = '/';
        
        iframe.onload = function() {
            log('Main app iframe loaded successfully', 'info');
        };
        
        iframe.onerror = function() {
            log('Main app iframe failed to load', 'error');
        };
        
        document.body.appendChild(iframe);
    </script>
</body>
</html>